<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <title>Simulador Champions (UF2)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; line-height:1.5; }
    h1, h2 { text-align: center; }
    .box { border:1px solid #ddd; padding:12px; margin:12px auto; max-width:700px; }
    .match { margin:8px 0; }
    .bold { font-weight:700; }
    button { padding:8px 12px; font-size:16px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Simulador Champions (Quarts → Semifinals → Final)</h1>
  <div style="text-align:center; margin-bottom:12px;">
    <button id="run">Simular torneig</button>
  </div>

  <div id="output" class="box"></div>

  <script>
  // ====== Config ======
  const initialTeams = [
    "Totthenham", "Manchester City", "Ajax", "Juventus",
    "Liverpool", "Porto", "Manchester United", "F.C. Barcelona"
  ];

  // ====== Utilitats ======
  // Barregem un array (Fisher-Yates)
  function shuffle(arr) {
    const a = arr.slice(); // copiar per no modificar original
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // Emparella en parelles a partir d'un array de 8 equips
  function pairTeams(teams) {
    const shuffled = shuffle(teams);
    const pairs = [];
    for (let i = 0; i < shuffled.length; i += 2) {
      pairs.push([shuffled[i], shuffled[i+1]]);
    }
    return pairs; // [[A,B], [C,D], ...]
  }

  // gols aleatoris 0..10 inclusive
  function randGoals() {
    return Math.floor(Math.random() * 11);
  }

  // Decide en penaltis (simulació aleatòria): retorna l'equip guanyador
  function decidePenaltyWinner(teamA, teamB) {
    return Math.random() < 0.5 ? teamA : teamB;
  }

  // Juga una eliminatòria a doble partit (ida+vuelta)
  // Aplica regla de gols fora de casa; si empata, penaltis aleatoris.
  function playTwoLegTie(teamA, teamB) {
    // Ida: teamA (casa) vs teamB (fora)
    const idaA = randGoals();
    const idaB = randGoals();

    // Tornada: teamB (casa) vs teamA (fora)
    const tornadaB = randGoals();
    const tornadaA = randGoals();

    // Gols totals
    const totalA = idaA + tornadaA;
    const totalB = idaB + tornadaB;

    // Gols fora de casa
    const awayA = tornadaA; // teamA fora a la tornada
    const awayB = idaB;     // teamB fora a la ida

    let winner = null;
    let reason = "";

    if (totalA > totalB) {
      winner = teamA;
      reason = `Aggregate ${totalA} - ${totalB}`;
    } else if (totalB > totalA) {
      winner = teamB;
      reason = `Aggregate ${totalB} - ${totalA}`;
    } else {
      // Empat en aggregate => aplicar away goals
      if (awayA > awayB) {
        winner = teamA;
        reason = `Aggregate ${totalA} - ${totalB} (desempat: més gols fora de casa ${awayA} > ${awayB})`;
      } else if (awayB > awayA) {
        winner = teamB;
        reason = `Aggregate ${totalA} - ${totalB} (desempat: més gols fora de casa ${awayB} > ${awayA})`;
      } else {
        // Persistència d'empat → penaltis aleatoris
        winner = decidePenaltyWinner(teamA, teamB);
        reason = `Aggregate ${totalA} - ${totalB}, away ${awayA} - ${awayB} → Penaltis (guanyador aleatori)`;
      }
    }

    return {
      teamA, teamB,
      ida: { home: teamA, away: teamB, scoreHome: idaA, scoreAway: idaB },
      tornada: { home: teamB, away: teamA, scoreHome: tornadaB, scoreAway: tornadaA },
      totals: { [teamA]: totalA, [teamB]: totalB },
      awayGoals: { [teamA]: awayA, [teamB]: awayB },
      winner,
      reason
    };
  }

  // Partit únic (final). Si empaten, penaltis aleatoris.
  function playSingleMatch(teamA, teamB) {
    const a = randGoals();
    const b = randGoals();
    let winner = null;
    let reason = "";
    if (a > b) {
      winner = teamA;
      reason = `${a} - ${b}`;
    } else if (b > a) {
      winner = teamB;
      reason = `${a} - ${b}`;
    } else {
      // Empat => penaltis
      winner = decidePenaltyWinner(teamA, teamB);
      reason = `${a} - ${b} (empat) → Penaltis (guanyador aleatori: ${winner})`;
    }
    return { teamA, teamB, scoreA: a, scoreB: b, winner, reason };
  }

  // Simula una ronda de doble partit a partir de pairs
  function simulateRound(pairs) {
    const results = [];
    const winners = [];
    for (const [a, b] of pairs) {
      const res = playTwoLegTie(a, b);
      results.push(res);
      winners.push(res.winner);
    }
    return { results, winners };
  }

  // Format i impressió (crea HTML per mostrar)
  function renderResults(title, roundResults, container) {
    const h = document.createElement('h2');
    h.textContent = title;
    container.appendChild(h);

    for (const r of roundResults) {
      const div = document.createElement('div');
      div.className = "match";
      let html = `<div class="bold">${r.teamA} vs ${r.teamB}</div>`;
      html += `<div>Ida: ${r.ida.home} ${r.ida.scoreHome} - ${r.ida.scoreAway} ${r.ida.away}</div>`;
      html += `<div>Tornada: ${r.tornada.home} ${r.tornada.scoreHome} - ${r.tornada.scoreAway} ${r.tornada.away}</div>`;
      html += `<div>Totals: ${r.teamA} ${r.totals[r.teamA]} - ${r.totals[r.teamB]} ${r.teamB}</div>`;
      html += `<div>Gols fora: ${r.teamA}(${r.awayGoals[r.teamA]}) - ${r.teamB}(${r.awayGoals[r.teamB]})</div>`;
      html += `<div>Guanyador: <span class="bold">${r.winner}</span> &nbsp;(<small>${r.reason}</small>)</div>`;
      div.innerHTML = html;
      container.appendChild(div);
    }
  }

  // Render per final single match
  function renderFinal(finalRes, container) {
    const h = document.createElement('h2');
    h.textContent = "FINAL";
    container.appendChild(h);

    const d = document.createElement('div');
    d.className = "match";
    d.innerHTML = `<div class="bold">${finalRes.teamA} ${finalRes.scoreA} - ${finalRes.scoreB} ${finalRes.teamB}</div>
                   <div>Guanyador: <span class="bold">${finalRes.winner}</span></div>
                   <div><small>${finalRes.reason}</small></div>`;
    container.appendChild(d);
  }

  // Simulador complet
  function simulateTournament() {
    const out = document.getElementById('output');
    out.innerHTML = ''; // netejar
    const teams = initialTeams.slice(); // copia

    // QUARTS: emparellar aleatoriament
    const quartersPairs = pairTeams(teams);
    const quarters = simulateRound(quartersPairs);
    renderResults("QUARTS DE FINAL", quarters.results, out);

    // SEMIS: emparellar guanyadors dels quarts (ordre aleatori)
    const semisPairs = pairTeams(quarters.winners);
    const semis = simulateRound(semisPairs);
    renderResults("SEMIFINALS", semis.results, out);

    // FINAL: partit únic entre els dos guanyadors
    const finalMatch = playSingleMatch(semis.winners[0], semis.winners[1]);
    renderFinal(finalMatch, out);

    // Guanyador final destacat
    const winnerDiv = document.createElement('div');
    winnerDiv.style.textAlign = 'center';
    winnerDiv.style.marginTop = '16px';
    winnerDiv.innerHTML = `<h2>GUANYADOR: ${finalMatch.winner}</h2>`;
    out.appendChild(winnerDiv);
  }

  // Enllaçar botó
  document.getElementById('run').addEventListener('click', simulateTournament);

  // Opcional: executar al carregar la pàgina per veure un resultat immediat
  // simulateTournament();
  </script>
</body>
</html>
